# Zuora Order API.

The implementation of the Zuora Order API in the engine is an interesting example of two different ways to go into interacting with an external system.

Zuora has migrated away from the old Zuora update API, in favour of the new Order API. The Order API aims to expose the various mutations that one can apply to a subscription using simplified, more organised, and somehow simpler to understand API payloads. For the kind of amendments the engine performs the documentation is [here](https://knowledgecenter.zuora.com/Zuora_Billing/Manage_subscription_transactions/Orders/Order_actions_tutorials/D_Replace_a_product_in_a_subscription).

When Pascal did the implementation the first time, for the SupporterPlus2024 migration, we ended up with this [type hierarchy](https://github.com/guardian/price-migration-engine/blob/bd15c7640eec2d55dbdbd90ff0be51b8c00d8540/lambda/src/main/scala/pricemigrationengine/model/ZuoraRenewOrderPayload.scala), which would have been fine if it wasn't for [tiny problems with the JSON serialization](https://github.com/guardian/price-migration-engine/blob/bd15c7640eec2d55dbdbd90ff0be51b8c00d8540/lambda/src/main/scala/pricemigrationengine/services/ZuoraLive.scala#L222), and would have been more useful if the hierarchy could be used from one migration to the other. 

Faced with the prospect of redefining slightly different and incompatible scala type hierarchies from one migration to another, Pascal decided to move "closer to the data" and introduced the [ZuoraOrdersApiPrimitives library](https://github.com/guardian/price-migration-engine/blob/513b6112b227bd8f94c22d71970c7f452af97edc/lambda/src/main/scala/pricemigrationengine/libs/ZuoraOrdersApiPrimitives.scala), the idea being that things get significantly easier and far more flexible if we focus on generating JSON `Value`s. The library has its own (hopefully thorough) [tests](https://github.com/guardian/price-migration-engine/blob/513b6112b227bd8f94c22d71970c7f452af97edc/lambda/src/test/scala/pricemigrationengine/libs/ZuoraOrdersApiPrimitivesTest.scala), but a an event of significance was the use of this library for the GuardianWeekly2025 migration. The first test of [happened here](https://github.com/guardian/price-migration-engine/pull/1145). This PR can be used as educational template for doing the same in future migrations (it's not final GuardianWeekly2025 migration code, because I hard coded a few values, both in the function body and the test body for simplification, but its the essence of it).

Full implementation: [https://github.com/guardian/price-migration-engine/pull/1148](https://github.com/guardian/price-migration-engine/pull/1148).
